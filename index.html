<!doctype html>
<html class="no-js" lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <!--========= Required meta tags =========-->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--====== Title ======-->
    <title>Tell us your history</title>

    <!--====== Favicon ======-->
    <link rel="shortcut icon" href="resources/static/images/logo.png" type="images/x-icon"/>

    <!--====== CSS Here ======-->
    <link rel="stylesheet" href="resources/static/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="resources/static/assets/css/animate.min.css">
    <link rel="stylesheet" href="resources/static/assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="resources/static/assets/css/lightcase.css">
    <link rel="stylesheet" href="resources/static/assets/css/meanmenu.css">
    <link rel="stylesheet" href="resources/static/assets/css/nice-select.css">
    <link rel="stylesheet" href="resources/static/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="resources/static/assets/css/datepicker.min.css">
    <link rel="stylesheet" href="resources/static/assets/css/jquery-ui.min.css">
    <link rel="stylesheet" href="resources/static/assets/css/default.css">
    <link rel="stylesheet" href="resources/static/assets/css/style.css">
    <link rel="stylesheet" href="resources/static/assets/css/responsive.css">

</head>

<body>

<!-- preloader  -->
<div id="preloader">
    <div id="ctn-preloader" class="ctn-preloader">
        <div class="animation-preloader">
            <div class="spinner"></div>
            <div class="txt-loading">
                        <span data-text-preloader="I" class="letters-loading">
                            І
                        </span>
                <span data-text-preloader="C" class="letters-loading">
                            С
                        </span>
                <span data-text-preloader="T" class="letters-loading">
                            Т
                        </span>
                <span data-text-preloader="O" class="letters-loading">
                            О
                        </span>
                <span data-text-preloader="P" class="letters-loading">
                            Р
                        </span>
                <span data-text-preloader="I" class="letters-loading">
                            Ї
                        </span>
            </div>
        </div>
        <div class="loader">
            <div class="row">
                <div class="col-3 loader-section section-left">
                    <div class="bg"></div>
                </div>
                <div class="col-3 loader-section section-left">
                    <div class="bg"></div>
                </div>
                <div class="col-3 loader-section section-right">
                    <div class="bg"></div>
                </div>
                <div class="col-3 loader-section section-right">
                    <div class="bg"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- preloader end -->

<!-- department area start -->
<section class="department-area bg-2 pt-110 pb-110">
    <div class="container">
        <div class="row" >
            <div class="col-lg-12">
                <div class="appointment-box mt-80"  data-background="resources/static/images/appointment2.png">
                    <div class="row">
                        <div class="col-xl-7 col-lg-10" style="z-index: 1">
                            <div class="section-heading">
                                <h4 class="sub-title">Є цікава історія?</h4>
                                <h2 class="section-title">Поділіться з нами <br> Зараз<span>.</span></h2>
                            </div>
                        </div>

                        <!-- Button trigger modal -->
                        <div class="col-xl-4 col-lg-6 my-auto text-right">
                            <button type="button" class="site-btn" data-toggle="modal" data-target="#exampleModal">
                                Поділитися Історією!
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>
<!-- department area end -->

<!-- modal contact area start -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
        <div class="row">
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade active show" id="appointment" role="tabpanel"
                                 aria-labelledby="appointment-tab">
                                <div class="contact-form">
                                    <form id="contactForm">
                                        <div class="row">
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <input type="text" name="name" placeholder="Ім'я" required>
                                                    <span class="icon"><i class="fal fa-user"></i></span>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <input type="text" name="surname" placeholder="Фамілія" required="required">
                                                    <span class="icon"><i class="fal fa-user"></i></span>
                                                </div>
                                            </div>
                                            <div class="col-lg-4">
                                                <div class="form-group">
                                                    <input type="text" name="patronymic" placeholder="По-батькові">
                                                    <span class="icon"><i class="fal fa-user"></i></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-5">
                                                <div class="form-group">
                                                    <input type="email" name="email" placeholder="Пошта" required="required">
                                                    <span class="icon"><i class="fal fa-envelope"></i></span>
                                                </div>
                                            </div>
                                            <div class="col-lg-5">
                                                <div class="form-group">
                                                    <input type="tel" name="phone" placeholder="Телефон" required="required">
                                                    <span class="icon"><i class="fal fa-phone"></i></span>
                                                </div>
                                            </div>
                                            <div class="col-lg-2">
                                                <div class="form-group">
                                                    <input type="text" name="age" placeholder="Вік" required="required">
                                                    <span class="icon"><i class="fal fa-calendar"></i></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="form-group">
                                                    <textarea placeholder="Розкажіть свою історію..." name="history" required="required"></textarea>
                                                    <span class="icon"><i class="fal fa-edit"></i></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row justify-content-center">
                                            <div class="col-lg-6 text-center py-2 py-lg-0">
                                                <button type="submit" class="site-btn">Поділитися</button>
                                            </div>
                                            <div class="col-lg-6 text-center py-2 py-lg-0">
                                                <button type="button" class="site-btn red" data-dismiss="modal">Скасувати</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</div>

<div class="chat-container container my-4">
    <div id="messages" class="messages mb-3">
        <!-- Articles list -->
    </div>

</div>

<!--========= ALL JS FORM ../assets/js Here =========-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="resources/static/assets/js/bootstrap.min.js"></script>
<script src="resources/static/assets/js/counterup.min.js"></script>
<script src="resources/static/assets/js/datepicker.min.js"></script>
<script src="resources/static/assets/js/datepicker.en.js"></script>
<script src="resources/static/assets/js/jquery-ui.min.js"></script>
<script src="resources/static/assets/js/jquery.nice-select.min.js"></script>
<script src="resources/static/assets/js/lightcase.js"></script>
<script src="resources/static/assets/js/owl.carousel.min.js"></script>
<script src="resources/static/assets/js/jquery.meanmenu.min.js"></script>
<script src="resources/static/assets/js/imagesloaded.pkgd.min.js"></script>
<script src="resources/static/assets/js/isotope.pkgd.min.js"></script>
<script src="resources/static/assets/js/wow.min.js"></script>
<script src="resources/static/assets/js/waypoint.js"></script>
<script src="resources/static/assets/js/main.js"></script>
</body>

<script>

    document.addEventListener('DOMContentLoaded', function () {
        function loadMessages() {
            $.ajax({
                url: 'mvc/controllers/getArticles.php',
                method: 'GET',
                dataType: 'json',
                success: function (data) {

                    const messagesContainer = document.getElementById('messages');
                    messagesContainer.innerHTML = '';

                    if (data.length === 0) {
                        messagesContainer.innerHTML = '<p class="error">Немає повідомлень.</p>';
                        return;
                    }

                    data.forEach(function(item) {
                        const messageDiv = document.createElement('div');
                        messageDiv.classList.add('message');

                        messageDiv.innerHTML = `
    <div class="message mb-3 p-3 border">
        <div class="d-flex justify-content-between">
            <strong>${item.name} ${item.surname} ${item.patronymic}</strong> <span class="text-muted">(${item.age} років)</span>
        </div>
        <div class="text-muted">
            <em>Email:</em> ${item.email} | <em>Телефон:</em> ${item.phone}
        </div>
         <div class="mt-2" style="word-break: break-word;">
            <p class="mb-0">${item.history ? item.history : 'Історія не вказана'}</p>
        </div>
    </div>
`;
                        messagesContainer.appendChild(messageDiv);
                    });

                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                },
                error: function (xhr, status, error) {
                    console.error('Get articles error:', error);
                    document.getElementById('messages').innerHTML = '<p class="error">Сталася помилка при завантаженні повідомлень.</p>';
                }
            });
        }

        $('form#contactForm').on('submit', function (e) {
            e.preventDefault();

            $.ajax({
                url: 'mvc/controllers/saveArticle.php',
                method: 'POST',
                data: $('form#contactForm').serialize(),
                dataType: 'json',
                success: function (response) {
                    $('#exampleModal').modal('hide');
                    $('#contactForm')[0].reset();
                    console.log(response);
                },
                function (xhr, status, error) {
                    console.error('Save article error:', error);
                }
            });
        });

        // setInterval(loadMessages, 2000);

        loadMessages();
    });

</script>
</html>
